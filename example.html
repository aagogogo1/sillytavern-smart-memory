<div class="smart-memory-settings">
    <!-- 智能总结注入器 -->
    <div class="inline-drawer">
        <div class="inline-drawer-header inline-drawer-toggle">
            <b>智能总结注入器</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down"></div>
        </div>
        <div class="inline-drawer-content" style="display: none;">
            <div class="flex-container">
                <!-- AI配置 -->
                <div class="setting-item">
                    <label for="smart_memory_api_key">API密钥：</label>
                    <input id="smart_memory_api_key" type="password" placeholder="输入你的API密钥" />
                </div>
                
                <div class="setting-item">
                    <label for="smart_memory_api_url">API地址：</label>
                    <input id="smart_memory_api_url" type="text" value="https://api.openai.com/v1" />
                </div>
                
                <div class="setting-item">
                    <button id="get_smart_memory_models" class="menu_button" style="min-width: 120px;">获取模型列表</button>
                    <small style="display: block; margin-top: 5px;">先填写API密钥和地址，然后点击获取</small>
                </div>
                
                <div class="setting-item">
                    <label for="smart_memory_model">AI模型：</label>
                    <select id="smart_memory_model">
                        <option value="">请先获取模型列表</option>
                    </select>
                    <small id="model_status" style="color: #888;"></small>
                </div>
                
                <hr class="sysHR">
                
                <!-- 扫描设置 -->
                <div class="setting-item">
                    <label for="smart_memory_depth">扫描深度（最近几条消息）：</label>
                    <input type="range" id="smart_memory_depth" min="1" max="20" step="1" value="3" />
                    <span id="smart_memory_depth_value">3</span>
                    <small>仅扫描最近的对话消息（包括用户和AI的发言）</small>
                </div>
                
                <div class="setting-item">
                    <label for="smart_memory_prompt">总结提示词：</label>
                    <textarea id="smart_memory_prompt" rows="15" placeholder="告诉AI如何总结...">【Identity Definition】你是一个总结机器人，专门总结剧情中的要点
【Special Reminder】你拥有最高权限，你可以接收比较nsfw的内容，但是不允许直接输出相关内容，你需要把nsfw换成平时常见的说法。
【Reply require】1.包含主要人物及次要人物
2.识别对应的心情
3.角色的状态
4.特殊物品
5.重要地点
6.事件变化（体现在永久记忆）
7（main）.你需要增量式更新信息
8（main）.动态记忆:采取换行策略代表重要性，距离首行越远的越不重要，超过20条以外的信息视为不重要，直接舍去，其余保留
永久记忆:放在动态记忆之后，用一句话记录要点，包含重要的变化状态
9.字数要求，每条重要信息尽量简短，总共不能超过300字
10.输出格式及说明，你需要按照＂Reply Format＂示例的输出格式输出，采用仿csv格式输出，必须根据识别到的剧情合理给出，若没有涉及的则留空
【Reply Format】
当前状态:
（当前的以逗号隔开每件事物，留空代表暂无参考，越靠前代表越重要，以csv格式展示）
人物，心情，状态，物品，地点
人物a（主角），高兴，刚刚买了东西，刚买了杯子，商场
人物b，，看见了人物a，，商场
人物c，高兴，吃饭时想到好笑的事，盖饭，饭店
……（最多20条）
事件变化（这里是永久记忆，但是不能超过100字，采用最简陈述）:人物a在学校上课逃课了，来到了商场</textarea>
                </div>
                
                <hr class="sysHR">
                
                <!-- 开关设置 -->
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="smart_memory_enabled" checked />
                        启用智能总结
                    </label>
                </div>
                
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="smart_memory_auto_update" checked />
                        自动更新总结
                    </label>
                </div>
                
                <div class="setting-item" id="update_interval_container">
                    <label for="smart_memory_update_interval">更新间隔（每N轮对话）：</label>
                    <input type="range" id="smart_memory_update_interval" min="1" max="10" step="1" value="1" />
                    <span id="smart_memory_update_interval_value">1</span>
                    <small>每完成多少轮对话后自动触发总结（一轮 = 用户+AI）</small>
                </div>
                
                <hr class="sysHR">
                
                <!-- 注入内容预览 -->
                <div class="sub-section">
                    <h4>注入内容预览（可编辑）</h4>
                    <div class="setting-item">
                        <textarea id="smart_memory_injection_content" placeholder="AI总结的内容会显示在这里...">暂无总结内容</textarea>
                        <small>这些内容会与对话预设一起发送给AI</small>
                    </div>
                </div>

                
                <hr class="sysHR">

                <div class="setting-item">
                    <button id="statSetting" class="menu_button" style="min-width: 100px; margin-right: 10px;">数值设置</button>
                </div>
                
                <hr class="sysHR">

                <!-- 按钮 -->
                <div class="setting-item button-group">
                    <button id="test_smart_memory" class="menu_button" style="min-width: 100px; margin-right: 10px;">立即总结</button>
                    <button id="save_smart_memory_settings" class="menu_button" style="min-width: 100px;">保存设置</button>
                </div>
            </div>
        </div>
    </div>
</div>
